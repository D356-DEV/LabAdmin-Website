<section class="container-fluid">
    <div class="row d-flex align-items-center justify-content-center py-5 gy-3">
        @if (lab) {
        <ng-container *ngTemplateOutlet="ready"></ng-container>
        } @else{
        <ng-container *ngTemplateOutlet="loading"></ng-container>
        }
    </div>
</section>

<ng-template #ready>
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-warning-subtle">
                <a routerLink="/labs" class="text-dark d-flex align-items-center">
                    <i class="bi bi-arrow-left-circle-fill me-1"></i> Volver
                </a>
                <h4 class="text-capitalize text-center">{{lab?.name}}</h4>
            </div>

            <div class="container shadow" style="
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%; 
            height: 250px; 
            overflow: hidden;">
                @if (lab?.lab_image) {
                <img [src]="'data:image/jpeg;base64,' + lab?.lab_image" class="card-img-top" alt="{{lab?.lab_image}}">
                } @else {
                <img src="/images/icon.png" class="img-fluid" alt="Imagen de laboratorio">
                }
            </div>
            <div class="card-body text-center p-3" style="height: 400px; overflow: auto;">
                <table class="table table-striped table-hover align-middle">
                    <tbody>
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-bank"></i> Institución:
                            </th>
                            <td class="text-capitalize">{{lab?.institution}}</td>
                        </tr>
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-buildings"></i> Campus:
                            </th>
                            <td class="text-capitalize">{{lab?.campus}}</td>
                        </tr>
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-lightbulb"></i> Especialidad:
                            </th>
                            <td class="text-capitalize">{{lab?.specialization}}</td>
                        </tr>
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-geo-alt"></i> Ubicación:
                            </th>
                            <td class="text-capitalize">{{lab?.location}}</td>
                        </tr>
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-file-text"></i> Descripción:
                            </th>
                            <td class="text-capitalize">{{lab?.description}}</td>
                        </tr>
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-person"></i> Capacidad:
                            </th>
                            <td class="text-capitalize">{{lab?.capacity + ' ' + 'personas'}}</td>
                        </tr>                        
                        <tr>
                            <th class="bg-warning text-dark px-1">
                                <i class="bi bi-person"></i> Manager:
                            </th>
                            <td class="text-capitalize">{{lab?.manager_id}}</td>
                        </tr>    
                    </tbody>
                </table>
                
                <div class="card-footer text-center">
                    <button class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#reservationModal">
                        Crear Reservacion <i class="bi bi-plus-circle ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModal" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning-subtle">
                    <h1 class="modal-title">
                        Crear Reservacion <i class="bi bi-building-fill-add"></i>
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body">
                    <form [formGroup]="reservationForm" (submit)="reservationLab()">
                        <div class="mb-3">
                            <label for="startTime" class="form-label">Hora de inicio: <i class="bi bi-clock-fill"></i></label>
                            <input type="time" class="form-control" id="startTime" formControlName="start_time" />
                            <div class="form-text">
                                Ingresa la hora de inicio de la reservación.
                                
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="endTime" class="form-label">Hora de finalizacion <i class="bi bi-clock-fill"></i></label>
                                    <input type="time" class="form-control" id="endTime" formControlName="end_time" />
                                    <div class="form-text">
                                        Ingresa la hora de finalizacion de la reservación.
                                        
                                    </div>
                        </div>

                        <div class="mb-3">
                            <label for="resvDescription" class="form-label">Descripción <i
                                    class="bi bi-info-circle-fill"></i></label>
                            <textarea class="form-control" id="resvDescription" rows="3"
                                formControlName="description"></textarea>
                            <div class="form-text">
                                Ingresa una breve descripción de la reservación.
                                Puedes incluir detalles como el propósito de la reservación.
                            </div>
                        </div>


                        @if (reservationMessage != '') {
                        <div class="alert alert-warning" role="alert">
                            {{ reservationMessage }}
                        </div>
                        }
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-warning w-100">
                                Generar solicitud de reservacion.<i class="bi bi-plus-circle mx-1"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-warning-subtle">
                <h4 class="text-capitalize text-center">Equipos</h4>
            </div>
            <div class="card-body text-center p-3" style="height: 300px; overflow: auto;">
                <p>En esta sección se muestran los equipos disponibles en este laboratorio. Aquí podrás consultar información sobre las computadoras, dispositivos y herramientas tecnológicas que pueden utilizarse para diversas actividades académicas y de investigación. Antes de realizar una reserva, asegúrate de que los equipos estén disponibles y en buen estado.</p>
            </div>
        </div>
    </div>
    
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-warning-subtle">
                <h4 class="text-capitalize text-center">Reservaciones</h4>
            </div>
            <div class="card-body text-center p-3" style="height: 300px; overflow: auto;">
                <p>Aquí se muestran las reservaciones programadas para este laboratorio. Puedes consultar los horarios disponibles y los espacios de tiempo reservados para clases, prácticas, conferencias o proyectos específicos. Si necesitas hacer una reservación, verifica la disponibilidad y sigue el proceso correspondiente.</p>
            </div>
        </div>
    </div>    
    
</ng-template>

<ng-template #loading>
    <div class="col text-center py-5">
        <div class="spinner-border text-dark" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3">Cargando...</p>
    </div>
</ng-template>